<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Video Player</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v7.0.0/dist/aframe-extras.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
</head>
<body>
    <!-- Scene MindAR -->
    <a-scene mindar-image="imageTargetSrc: https://devxr.fr/vinyls/assets/mind/targets.mind" color-space="sRGB" renderer="colorManagement: true, physicallyCorrectLights" vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false">
        <a-assets>
            <!-- Chargement des vidéos dans les assets -->
            <video id="danceVideo" src="https://devxr.fr/vinyls/assets/video/DANSE.mp4" loop crossorigin="anonymous"></video>
            <video id="oneMoreTimeVideo" src="https://devxr.fr/vinyls/assets/video/One_More%20Time.mp4" loop crossorigin="anonymous"></video>
            <video id="hereComesTheSunVideo" src="https://devxr.fr/vinyls/assets/video/here_come_the_sun.mp4" loop crossorigin="anonymous"></video>
            <video id="soundOfSilenceVideo" src="https://devxr.fr/vinyls/assets/video/sound_of_silence.mp4" loop crossorigin="anonymous"></video>
            <video id="getLuckyVideo" src="https://devxr.fr/vinyls/assets/video/get_lucky.mp4" loop crossorigin="anonymous"></video>
            <video id="poinconneurLilasVideo" src="https://devxr.fr/vinyls/assets/video/le_poinconneur_des_lilas.mp4" loop crossorigin="anonymous"></video>
            <video id="watchTowerVideo" src="https://devxr.fr/vinyls/assets/video/all_along_the_watchtower.mp4" loop crossorigin="anonymous"></video>
            <video id="deltaVideo" src="https://devxr.fr/vinyls/assets/video/delta.mp4" loop crossorigin="anonymous"></video>
            <video id="sharkInTheAirVideo" src="https://devxr.fr/vinyls/assets/video/skank_in_the_air.mp4" loop crossorigin="anonymous"></video>
            <video id="leTempsEstBonVideo" src="https://devxr.fr/vinyls/assets/video/le_temps_est_bon.mp4" loop crossorigin="anonymous"></video>
            <video id="00Video" src="https://devxr.fr/vinyls/assets/video/(OO).mp4" loop crossorigin="anonymous"></video>
            <video id="SundayBloodySundayVideo" src="https://devxr.fr/vinyls/assets/video/sunday_bloody_bunday.mp4" loop crossorigin="anonymous"></video>
        </a-assets>

        <!-- Caméra -->
        <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

        <!-- Plan pour chaque vidéo sur les cibles -->
        <a-entity mindar-image-target="targetIndex: 0" id="targetDance">
            <a-plane rotation="0 0 0" position="0 0 0" width="1" height="0.5" src="#danceVideo"></a-plane>
        </a-entity>

        <a-entity mindar-image-target="targetIndex: 1" id="targetOneMoreTime">
            <a-plane rotation="0 0 0" position="0 0 0" width="1" height="0.5" src="#oneMoreTimeVideo"></a-plane>
        </a-entity>

        <a-entity mindar-image-target="targetIndex: 2" id="targetHereComesTheSun">
            <a-plane rotation="0 0 0" position="0 0 0" width="1" height="0.5" src="#hereComesTheSunVideo"></a-plane>
        </a-entity>

        <a-entity mindar-image-target="targetIndex: 3" id="targetSoundOfSilence">
            <a-plane rotation="0 0 0" position="0 0 0" width="1" height="0.5" src="#soundOfSilenceVideo"></a-plane>
        </a-entity>

        <a-entity mindar-image-target="targetIndex: 4" id="targetGetLucky">
            <a-plane rotation="0 0 0" position="0 0 0" width="1" height="0.5" src="#getLuckyVideo"></a-plane>
        </a-entity>

        <a-entity mindar-image-target="targetIndex: 5" id="targetPoinconneurLilas">
            <a-plane rotation="0 0 0" position="0 0 0" width="1" height="0.5" src="#poinconneurLilasVideo"></a-plane>
        </a-entity>

        <a-entity mindar-image-target="targetIndex: 6" id="targetWatchTower">
            <a-plane rotation="0 0 0" position="0 0 0" width="1" height="0.5" src="#watchTowerVideo"></a-plane>
        </a-entity>

        <a-entity mindar-image-target="targetIndex: 7" id="targetDelta">
            <a-plane rotation="0 0 0" position="0 0 0" width="1" height="0.5" src="#deltaVideo"></a-plane>
        </a-entity>

        <a-entity mindar-image-target="targetIndex: 8" id="targetSharkInTheAir">
            <a-plane rotation="0 0 0" position="0 0 0" width="1" height="0.5" src="#sharkInTheAirVideo"></a-plane>
        </a-entity>

        <a-entity mindar-image-target="targetIndex: 9" id="targetLeTempsEstBon">
            <a-plane rotation="0 0 0" position="0 0 0" width="1" height="0.5" src="#leTempsEstBonVideo"></a-plane>
        </a-entity>

        <a-entity mindar-image-target="targetIndex: 10" id="target00">
            <a-plane rotation="0 0 0" position="0 0 0" width="1" height="0.5" src="#00Video"></a-plane>
        </a-entity>

        <a-entity mindar-image-target="targetIndex: 11" id="targetSundayBloodySunday">
            <a-plane rotation="0 0 0" position="0 0 0" width="1" height="0.5" src="#SundayBloodySundayVideo"></a-plane>
        </a-entity>
    </a-scene>

    <!-- Bouton de démarrage pour lire la vidéo avec le son -->
    <button id="startButton" style="position: absolute; bottom: 20px; z-index: 10; display: none; opacity: 0; background: red; border-radius: 20px; border: 2px solid #fff; transition: opacity .5s ease-out">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-player-play-filled" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#ffffff" fill="#ffffff" stroke-linecap="round" stroke-linejoin="round" style="margin: 3px 10px 0 10px;">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M6 4v16a1 1 0 0 0 1.524 .852l13 -8a1 1 0 0 0 0 -1.704l-13 -8a1 1 0 0 0 -1.524 .852z" stroke-width="0" fill="#fff" />
        </svg>
    </button>

    <script>
        const displayButton = (window.innerWidth / 2) - 50;

        var currentVideo = null;
        var startButton = document.getElementById('startButton');
        startButton.style.left = displayButton + 'px';

        // Fonction pour afficher le bouton et démarrer la vidéo
        function showButtonAndPlay(videoElement) {
            startButton.style.display = 'block';
            currentVideo = videoElement;
            setTimeout(() => {
                startButton.style.opacity = '1';
            }, 0);
        }

        // Cacher le bouton après avoir démarré la vidéo avec le son
        startButton.addEventListener('click', function () {
            if (currentVideo) {
                currentVideo.play().catch(function () {
                    console.log('Impossible de lire la vidéo avec son');
                });
                setTimeout(() => {
                    startButton.style.opacity = '0'; // Cacher le bouton après le clic
                }, 0);
                startButton.style.display = 'none'; // Cacher le bouton après le clic
            }
        });

        // Fonction générique pour la gestion des événements de cibles
        function setupTargetEvents(targetElement, videoElement) {
            targetElement.addEventListener('targetFound', function () {
                console.log('Image détectée pour ' + videoElement.id);
                showButtonAndPlay(videoElement);
            });

            targetElement.addEventListener('targetLost', function () {
                console.log('Image perdue pour ' + videoElement.id);
                if (!videoElement.paused) {
                    videoElement.pause();  // Arrêter la vidéo si l'image n'est plus détectée
                    videoElement.currentTime = 0;  // Remettre la vidéo au début
                }
                startButton.style.display = 'none'; // Cacher le bouton
            });
        }

        // Initialisation des vidéos et cibles
        var videos = {
            'targetDance': document.getElementById('danceVideo'),
            'targetOneMoreTime': document.getElementById('oneMoreTimeVideo'),
            'targetHereComesTheSun': document.getElementById('hereComesTheSunVideo'),
            'targetSoundOfSilence': document.getElementById('soundOfSilenceVideo'),
            'targetGetLucky': document.getElementById('getLuckyVideo'),
            'targetPoinconneurLilas': document.getElementById('poinconneurLilasVideo'),
            'targetWatchTower': document.getElementById('watchTowerVideo'),
            'targetDelta': document.getElementById('deltaVideo'),
            'targetSharkInTheAir': document.getElementById('sharkInTheAirVideo'),
            'targetLeTempsEstBon': document.getElementById('leTempsEstBonVideo'),
            'target00': document.getElementById('00Video'),
            'targetSundayBloodySunday': document.getElementById('SundayBloodySundayVideo')
        };

        // Associer chaque cible à sa vidéo correspondante
        Object.keys(videos).forEach(function (targetId) {
            var targetElement = document.getElementById(targetId);
            var videoElement = videos[targetId];
            setupTargetEvents(targetElement, videoElement);
        });
    </script>

</body>
</html>
